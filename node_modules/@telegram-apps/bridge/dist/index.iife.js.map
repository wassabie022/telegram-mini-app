{"version":3,"file":"index.iife.js","sources":["../../transformers/dist/index.js","../src/env/hasWebviewProxy.ts","../src/env/isIframe.ts","../../toolkit/dist/index.js","../../signals/dist/index.js","../src/debug.ts","../src/events/transformers.ts","../src/events/listening/lastEvent.ts","../src/events/listening/signalFor.ts","../src/events/listening/on.ts","../src/errors.ts","../src/methods/$targetOrigin.ts","../src/methods/postEvent.ts","../src/utils/request.ts","../src/launch-params/parseLaunchParams.ts","../src/launch-params/retrieveFromUrl.ts","../src/launch-params/retrieveFromLocation.ts","../src/launch-params/retrieveFromPerformance.ts","../src/launch-params/storage.ts","../src/launch-params/retrieveLaunchParams.ts","../src/env/isTMA.ts","../src/events/emitMiniAppsEvent.ts","../src/env/mockTelegramEnv.ts","../src/events/handling/defineEventHandlers.ts","../src/events/handling/removeEventHandlers.ts","../src/events/listening/off.ts","../src/events/listening/subscribe.ts","../src/events/listening/unsubscribe.ts","../src/methods/captureSameReq.ts","../src/utils/compareVersions.ts","../src/methods/supports.ts","../src/methods/createPostEvent.ts","../src/utils/invokeCustomMethod.ts","../src/resetPackageState.ts"],"sourcesContent":["class i extends Error {\n  constructor(e, r, a) {\n    super(\n      typeof r == \"object\" ? r.message : r || e,\n      {\n        cause: typeof r == \"object\" ? r.cause : a\n      }\n    ), this.type = e, Object.setPrototypeOf(this, i.prototype);\n  }\n}\nfunction b(t) {\n  return t.replace(/[A-Z]/g, (e) => `_${e.toLowerCase()}`);\n}\nfunction E(t) {\n  return t.replace(/_[a-z]/g, (e) => e[1].toUpperCase());\n}\nconst R = \"ERR_INVALID_VALUE\", S = \"ERR_UNEXPECTED_VALUE\", w = \"ERR_UNEXPECTED_TYPE\", h = \"ERR_PARSE\";\nfunction y(t, e) {\n  const r = {};\n  for (const a in t) {\n    const n = t[a];\n    if (!n)\n      continue;\n    let o, c;\n    typeof n == \"function\" ? (o = a, c = n) : [o, c] = n;\n    try {\n      const p = c(e(o));\n      p !== void 0 && (r[a] = p);\n    } catch (p) {\n      throw new i(\n        h,\n        `Parser for \"${a}\" property failed${o === a ? \"\" : `. Source field: \"${o}\"`}`,\n        p\n      );\n    }\n  }\n  return r;\n}\nfunction d(t) {\n  let e = t;\n  if (typeof e == \"string\")\n    try {\n      e = JSON.parse(e);\n    } catch (r) {\n      throw new i(R, { cause: r });\n    }\n  if (typeof e != \"object\" || !e || Array.isArray(e))\n    throw new i(S);\n  return e;\n}\nfunction s(t, e) {\n  return (r) => {\n    const a = (n) => {\n      if (!(r && n === void 0))\n        try {\n          return e(n);\n        } catch (o) {\n          throw new i(h, {\n            message: `\"${t}\" transformer failed to parse the value`,\n            cause: o\n          });\n        }\n    };\n    return /* @__PURE__ */ Object.assign(\n      a,\n      {\n        isValid(n) {\n          try {\n            return a(n), !0;\n          } catch {\n            return !1;\n          }\n        }\n      }\n    );\n  };\n}\nfunction l(t, e) {\n  return s(e || \"object\", (r) => {\n    const a = d(r);\n    return y(t, (n) => a[n]);\n  });\n}\nfunction f(t) {\n  throw new i(w, `Unexpected value received: ${JSON.stringify(t)}`);\n}\nconst A = s(\"boolean\", (t) => {\n  if (typeof t == \"boolean\")\n    return t;\n  const e = String(t);\n  if (e === \"1\" || e === \"true\")\n    return !0;\n  if (e === \"0\" || e === \"false\")\n    return !1;\n  f(t);\n}), u = s(\"string\", (t) => {\n  if (typeof t == \"string\" || typeof t == \"number\")\n    return t.toString();\n  f(t);\n}), g = s(\"number\", (t) => {\n  if (typeof t == \"number\")\n    return t;\n  if (typeof t == \"string\") {\n    const e = Number(t);\n    if (!Number.isNaN(e))\n      return e;\n  }\n  f(t);\n}), D = s(\"date\", (t) => t instanceof Date ? t : new Date(g()(t) * 1e3));\nfunction P(t, e) {\n  return s(e || \"searchParams\", (r) => {\n    typeof r != \"string\" && !(r instanceof URLSearchParams) && f(r);\n    const a = typeof r == \"string\" ? new URLSearchParams(r) : r;\n    return y(t, (n) => {\n      const o = a.get(n);\n      return o === null ? void 0 : o;\n    });\n  });\n}\nfunction m(t) {\n  for (const e in t)\n    t[e] = [b(e), t[e]];\n  return t;\n}\nconst U = (t) => {\n  const e = g(), r = g(!0), a = u(), n = u(!0), o = A(!0), c = l(m({\n    addedToAttachmentMenu: o,\n    allowsWriteToPm: o,\n    firstName: a,\n    id: e,\n    isBot: o,\n    isPremium: o,\n    languageCode: n,\n    lastName: n,\n    photoUrl: n,\n    username: n\n  }), \"User\")(!0);\n  return P(\n    m({\n      authDate: D(),\n      canSendAfter: r,\n      chat: l(\n        m({\n          id: e,\n          type: a,\n          title: a,\n          photoUrl: n,\n          username: n\n        }),\n        \"Chat\"\n      )(!0),\n      chatInstance: n,\n      chatType: n,\n      hash: a,\n      queryId: n,\n      receiver: c,\n      startParam: n,\n      user: c\n    }),\n    \"initData\"\n  )(t);\n};\nfunction N(t) {\n  return /^#[\\da-f]{6}$/i.test(t);\n}\nfunction O(t) {\n  return /^#[\\da-f]{3}$/i.test(t);\n}\nfunction W(t) {\n  const e = t.replace(/\\s/g, \"\").toLowerCase();\n  if (N(e))\n    return e;\n  if (O(e)) {\n    let a = \"#\";\n    for (let n = 0; n < 3; n += 1)\n      a += e[1 + n].repeat(2);\n    return a;\n  }\n  const r = e.match(/^rgb\\((\\d{1,3}),(\\d{1,3}),(\\d{1,3})\\)$/) || e.match(/^rgba\\((\\d{1,3}),(\\d{1,3}),(\\d{1,3}),\\d{1,3}\\)$/);\n  if (!r)\n    throw new Error(`Value \"${t}\" does not satisfy any of known RGB formats.`);\n  return r.slice(1).reduce((a, n) => {\n    const o = parseInt(n, 10).toString(16);\n    return a + (o.length === 1 ? \"0\" : \"\") + o;\n  }, \"#\");\n}\nconst _ = s(\"rgb\", (t) => W(u()(t))), T = s(\n  \"themeParams\",\n  (t) => {\n    const e = _(!0);\n    return Object.entries(d(t)).reduce((r, [a, n]) => (r[E(a)] = e(n), r), {});\n  }\n);\n// @__NO_SIDE_EFFECTS__\nfunction V(t) {\n  return JSON.stringify(\n    Object.fromEntries(\n      Object.entries(t).map(([e, r]) => [b(e), r])\n    )\n  );\n}\nconst $ = (t) => {\n  const e = u(), r = u(!0), a = A(!0);\n  return P({\n    botInline: [\"tgWebAppBotInline\", a],\n    initData: [\"tgWebAppData\", U(!0)],\n    initDataRaw: [\"tgWebAppData\", r],\n    platform: [\"tgWebAppPlatform\", e],\n    showSettings: [\"tgWebAppShowSettings\", a],\n    startParam: [\"tgWebAppStartParam\", r],\n    themeParams: [\"tgWebAppThemeParams\", T()],\n    version: [\"tgWebAppVersion\", e]\n  }, \"launchParams\")(t);\n};\n// @__NO_SIDE_EFFECTS__\nfunction j(t) {\n  const { initDataRaw: e, startParam: r, showSettings: a, botInline: n } = t, o = new URLSearchParams();\n  return o.set(\"tgWebAppPlatform\", t.platform), o.set(\"tgWebAppThemeParams\", /* @__PURE__ */ V(t.themeParams)), o.set(\"tgWebAppVersion\", t.version), e && o.set(\"tgWebAppData\", e), r && o.set(\"tgWebAppStartParam\", r), typeof a == \"boolean\" && o.set(\"tgWebAppShowSettings\", a ? \"1\" : \"0\"), typeof n == \"boolean\" && o.set(\"tgWebAppBotInline\", n ? \"1\" : \"0\"), o.toString();\n}\nconst L = l({\n  eventType: u(),\n  eventData: (t) => t\n}, \"miniAppsMessage\");\nfunction I(t, e) {\n  return s(e || \"array\", (r) => {\n    let a;\n    if (Array.isArray(r))\n      a = r;\n    else if (typeof r == \"string\")\n      try {\n        const n = JSON.parse(r);\n        Array.isArray(n) && (a = n);\n      } catch {\n      }\n    return a || f(r), a.map(t);\n  });\n}\nconst C = s(\"fn\", (t) => {\n  if (typeof t == \"function\")\n    return t;\n  f(t);\n});\nfunction B(t) {\n  return !!t && typeof t == \"object\" && !Array.isArray(t);\n}\nexport {\n  R as ERR_INVALID_VALUE,\n  h as ERR_PARSE,\n  w as ERR_UNEXPECTED_TYPE,\n  S as ERR_UNEXPECTED_VALUE,\n  I as array,\n  A as boolean,\n  s as createTransformerGen,\n  D as date,\n  C as fn,\n  U as initData,\n  N as isRGB,\n  O as isRGBShort,\n  B as isRecord,\n  $ as launchParams,\n  L as miniAppsMessage,\n  g as number,\n  l as object,\n  _ as rgb,\n  P as searchParams,\n  j as serializeLaunchParams,\n  V as serializeThemeParams,\n  u as string,\n  T as themeParams,\n  W as toRGB,\n  d as toRecord\n};\n//# sourceMappingURL=index.js.map\n","import { object, fn } from '@telegram-apps/transformers';\n\ninterface WithWebviewProxy {\n  TelegramWebviewProxy: {\n    postEvent: (...args: unknown[]) => unknown;\n  };\n}\n\nconst webViewProxy = object<WithWebviewProxy>({\n  TelegramWebviewProxy: object({ postEvent: fn() })(),\n});\n\n/**\n * Returns true in case, passed value contains path `TelegramWebviewProxy.postEvent` property and\n * `postEvent` is a function.\n * @param value - value to check.\n */\nexport function hasWebviewProxy<T>(value: T): value is T & WithWebviewProxy {\n  return webViewProxy().isValid(value);\n}\n","/**\n * @see https://stackoverflow.com/a/326076\n * @returns True, if current environment is iframe.\n */\nexport function isIframe(): boolean {\n  try {\n    return window.self !== window.top;\n  } catch {\n    return true;\n  }\n}\n","var k = Object.defineProperty;\nvar I = (r, e, t) => e in r ? k(r, e, { enumerable: !0, configurable: !0, writable: !0, value: t }) : r[e] = t;\nvar E = (r, e, t) => I(r, typeof e != \"symbol\" ? e + \"\" : e, t);\nclass d extends Error {\n  constructor(e, t, n) {\n    super(\n      typeof t == \"object\" ? t.message : t || e,\n      {\n        cause: typeof t == \"object\" ? t.cause : n\n      }\n    ), this.type = e, Object.setPrototypeOf(this, d.prototype);\n  }\n}\nfunction x(r, e, t) {\n  return r.addEventListener(e, t), () => r.removeEventListener(e, t);\n}\nfunction _(...r) {\n  const e = r.flat(1);\n  return [\n    e.push.bind(e),\n    () => {\n      e.forEach((t) => {\n        t();\n      });\n    }\n  ];\n}\nfunction F(r, e) {\n  return r instanceof d && r.type === e;\n}\nfunction m(r) {\n  return (e) => F(e, r);\n}\nconst R = \"ERR_ABORTED\", $ = \"ERR_CANCELED\", S = \"ERR_TIMED_OUT\";\nfunction C(r) {\n  return new d(R, { cause: r });\n}\nconst U = m(S), V = m(R), B = m($);\nfunction T(r, e) {\n  return r.reject = e.reject, r;\n}\nclass i extends Promise {\n  constructor(t, n) {\n    let o, s;\n    typeof t == \"function\" ? (o = t, s = n) : s = t;\n    let u, c;\n    super((a, h) => {\n      s || (s = {});\n      const { abortSignal: l } = s;\n      if (l && l.aborted)\n        return h(C(l.reason));\n      const [y, A] = _(), b = (f) => (...L) => (A(), f(...L)), w = new AbortController(), { signal: D } = w;\n      c = b((f) => {\n        w.abort(f), h(f);\n      }), u = b(a), l && y(\n        x(l, \"abort\", () => {\n          c(C(l.reason));\n        })\n      );\n      const { timeout: g } = s;\n      if (g) {\n        const f = setTimeout(() => {\n          c(new d(S, `Timeout reached: ${g}ms`));\n        }, g);\n        y(() => {\n          clearTimeout(f);\n        });\n      }\n      o && o(u, c, D);\n    });\n    /**\n     * Rejects the promise.\n     */\n    E(this, \"reject\");\n    this.reject = c;\n  }\n  /**\n   * Creates a new BetterPromise instance using executor, resolving promise when a result\n   * was returned.\n   * @param fn - function returning promise result.\n   * @param options - additional options.\n   */\n  static withFn(t, n) {\n    return new i((o, s, u) => {\n      try {\n        const c = t(u);\n        return c instanceof Promise ? c.then(o, s) : o(c);\n      } catch (c) {\n        s(c);\n      }\n    }, n);\n  }\n  /**\n   * @see Promise.resolve\n   */\n  static resolve(t) {\n    return new i((n) => {\n      n(t);\n    });\n  }\n  /**\n   * @see Promise.reject\n   */\n  static reject(t) {\n    return new i((n, o) => {\n      o(t);\n    });\n  }\n  /**\n   * Cancels the promise execution.\n   */\n  cancel() {\n    this.reject(new d($));\n  }\n  /**\n   * @see Promise.catch\n   */\n  catch(t) {\n    return this.then(void 0, t);\n  }\n  /**\n   * @see Promise.finally\n   */\n  finally(t) {\n    return T(super.finally(t), this);\n  }\n  /**\n   * @see Promise.then\n   */\n  then(t, n) {\n    return T(super.then(t, n), this);\n  }\n}\nfunction v(r, e) {\n  return r.resolve = e.resolve, r;\n}\nclass p extends i {\n  constructor(t, n) {\n    let o, s;\n    typeof t == \"function\" ? (o = t, s = n) : s = t;\n    let u;\n    super((c, a, h) => {\n      u = c, o && o(c, a, h);\n    }, s);\n    /**\n     * Resolves the promise.\n     */\n    E(this, \"resolve\");\n    this.resolve = u;\n  }\n  /**\n   * Creates a new EnhancedPromise instance using executor, resolving promise when a result\n   * was returned.\n   * @param fn - function returning promise result.\n   * @param options - additional options.\n   */\n  static withFn(t, n) {\n    return new p(\n      (o, s, u) => i.withFn(t, { abortSignal: u }).then(o, s),\n      n\n    );\n  }\n  /**\n   * @see Promise.resolve\n   */\n  static resolve(t) {\n    return new p((n) => {\n      n(t);\n    });\n  }\n  /**\n   * @see Promise.reject\n   */\n  static reject(t) {\n    return new p((n, o) => {\n      o(t);\n    });\n  }\n  /**\n   * @see Promise.catch\n   */\n  catch(t) {\n    return this.then(void 0, t);\n  }\n  /**\n   * @see Promise.finally\n   */\n  finally(t) {\n    return v(super.finally(t), this);\n  }\n  /**\n   * @see Promise.then\n   */\n  then(t, n) {\n    return v(super.then(t, n), this);\n  }\n}\nfunction Z(r, e) {\n  return new i((t) => {\n    setTimeout(t, r);\n  }, { abortSignal: e });\n}\nfunction j(r) {\n  return `tapps/${r}`;\n}\nfunction J(r, e) {\n  sessionStorage.setItem(j(r), JSON.stringify(e));\n}\nfunction K(r) {\n  const e = sessionStorage.getItem(j(r));\n  try {\n    return e ? JSON.parse(e) : void 0;\n  } catch {\n  }\n}\nfunction M(r) {\n  return r.replace(/[A-Z]/g, (e) => `-${e.toLowerCase()}`);\n}\nfunction z(r) {\n  return r.replace(/[A-Z]/g, (e) => `_${e.toLowerCase()}`);\n}\nfunction G(r) {\n  return r.replace(/_[a-z]/g, (e) => e[1].toUpperCase());\n}\n// @__NO_SIDE_EFFECTS__\nfunction q(r, e) {\n  e || (e = {});\n  const {\n    textColor: t,\n    bgColor: n,\n    shouldLog: o = !0\n  } = e;\n  function s(u, ...c) {\n    if (!o || typeof o == \"function\" && !o())\n      return;\n    const a = \"font-weight:bold;padding:0 5px;border-radius:5px\";\n    console[u](\n      `%c${Intl.DateTimeFormat(\"en-GB\", {\n        hour: \"2-digit\",\n        minute: \"2-digit\",\n        second: \"2-digit\",\n        fractionalSecondDigits: 3,\n        timeZone: \"UTC\"\n      }).format(/* @__PURE__ */ new Date())}%c / %c${r}`,\n      `${a};background-color: lightblue;color:black`,\n      \"\",\n      `${a};${t ? `color:${t};` : \"\"}${n ? `background-color:${n}` : \"\"}`,\n      ...c\n    );\n  }\n  return [\n    function(...c) {\n      s(\"log\", ...c);\n    },\n    function(...c) {\n      s(\"error\", ...c);\n    }\n  ];\n}\nfunction H(r, e) {\n  document.documentElement.style.setProperty(r, e);\n}\nfunction P(r) {\n  document.documentElement.style.removeProperty(r);\n}\nexport {\n  i as CancelablePromise,\n  R as ERR_ABORTED,\n  $ as ERR_CANCELED,\n  S as ERR_TIMED_OUT,\n  p as EnhancedPromise,\n  d as TypedError,\n  x as addEventListener,\n  M as camelToKebab,\n  z as camelToSnake,\n  C as createAbortError,\n  _ as createCbCollector,\n  q as createLogger,\n  m as createTypedErrorPredicate,\n  P as deleteCssVar,\n  K as getStorageValue,\n  V as isAbortError,\n  B as isCanceledError,\n  F as isErrorOfType,\n  U as isTimeoutError,\n  H as setCssVar,\n  J as setStorageValue,\n  Z as sleep,\n  G as snakeToCamel\n};\n//# sourceMappingURL=index.js.map\n","let i;\nfunction y(e, s) {\n  i && i.set(e, s) || s();\n}\nfunction m(e) {\n  if (i)\n    return e();\n  i = /* @__PURE__ */ new Map();\n  try {\n    e();\n  } finally {\n    i.forEach((s) => s()), i = void 0;\n  }\n}\n// @__NO_SIDE_EFFECTS__\nfunction S(e, s) {\n  s || (s = {});\n  const d = s.equals || Object.is;\n  let n = [], c = e;\n  const a = (t) => {\n    if (!d(c, t)) {\n      const u = c;\n      c = t, y(l, () => {\n        [...n].forEach(([f, g]) => {\n          f(t, u), g && r(f, !0);\n        });\n      });\n    }\n  };\n  function o(t) {\n    const u = typeof t != \"object\" ? { once: t } : t;\n    return {\n      once: u.once || !1,\n      signal: u.signal || !1\n    };\n  }\n  const r = (t, u) => {\n    const f = o(u), g = n.findIndex(([h, p]) => h === t && p.once === f.once && p.signal === f.signal);\n    g >= 0 && n.splice(g, 1);\n  }, l = Object.assign(\n    function() {\n      return j(l), c;\n    },\n    {\n      destroy() {\n        n = [];\n      },\n      set: a,\n      reset() {\n        a(e);\n      },\n      sub(t, u) {\n        return n.push([t, o(u)]), () => r(t, u);\n      },\n      unsub: r,\n      unsubAll() {\n        n = n.filter((t) => t[1].signal);\n      }\n    }\n  );\n  return l;\n}\nconst b = [];\nfunction j(e) {\n  b.length && b[b.length - 1].add(e);\n}\n// @__NO_SIDE_EFFECTS__\nfunction x(e, s) {\n  let d = /* @__PURE__ */ new Set();\n  const n = /* @__PURE__ */ S(a(), s);\n  function c() {\n    n.set(a());\n  }\n  function a() {\n    d.forEach((l) => l.unsub(c, { signal: !0 }));\n    const o = /* @__PURE__ */ new Set();\n    let r;\n    b.push(o);\n    try {\n      r = e();\n    } finally {\n      b.pop();\n    }\n    return o.forEach((l) => {\n      l.sub(c, { signal: !0 });\n    }), d = o, r;\n  }\n  return Object.assign(function() {\n    return n();\n  }, {\n    destroy: n.destroy,\n    sub: n.sub,\n    unsub: n.unsub,\n    unsubAll: n.unsubAll\n  });\n}\nexport {\n  m as batch,\n  x as computed,\n  S as signal\n};\n//# sourceMappingURL=index.js.map\n","import { signal } from '@telegram-apps/signals';\nimport { createLogger } from '@telegram-apps/toolkit';\n\n/**\n * The package debug mode.\n *\n * Enabling debug mode leads to printing additional messages in the console related to the\n * processes inside the package.\n */\nexport const $debug = signal(false);\n\nexport const [logInfo, logError] = createLogger('Bridge', {\n  bgColor: '#9147ff',\n  textColor: 'white',\n  shouldLog: $debug,\n});\n","import {\n  boolean,\n  createTransformerGen,\n  number,\n  object,\n  string,\n  type TransformerGen,\n} from '@telegram-apps/transformers';\n\nimport type { EventName, EventPayload } from '@/events/types/events.js';\n\n/**\n * Transformers for problematic Mini Apps events.\n */\nexport const transformers: { [E in EventName]?: TransformerGen<EventPayload<E>> } = {\n  clipboard_text_received: object({\n    req_id: string(),\n    data: (value) => (value === null ? value : string(true)(value)),\n  }, 'clipboard_text_received'),\n  custom_method_invoked: object({\n    req_id: string(),\n    result: (value) => value,\n    error: string(true),\n  }, 'custom_method_invoked'),\n  popup_closed: createTransformerGen('popup_closed', value => {\n    return value\n      ? object({\n        button_id: (value) => (\n          value === null || value === undefined ? undefined : string()(value)\n        ),\n      })()(value)\n      : {};\n  }),\n  viewport_changed: object({\n    height: number(),\n    width: (value) => (\n      value === null || value === undefined\n        ? window.innerWidth\n        : number()(value)\n    ),\n    is_state_stable: boolean(),\n    is_expanded: boolean(),\n  }, 'viewport_changed'),\n};","import { createCbCollector, addEventListener, type If, type IsNever } from '@telegram-apps/toolkit';\nimport { Signal, signal } from '@telegram-apps/signals';\nimport { miniAppsMessage, type MiniAppsMessage } from '@telegram-apps/transformers';\n\nimport { logError, logInfo } from '@/debug.js';\n\nimport { transformers } from '../transformers.js';\nimport type { EventPayload, EventName } from '../types/events.js';\n\nexport type LastEvent = {\n  [E in EventName]: [E, If<IsNever<EventPayload<E>>, undefined, EventPayload<E>>]\n}[EventName];\n\n/**\n * Creates window event listeners, tracking Mini Apps events and calling passed handler with their\n * data.\n * @param onEvent - event callback.\n */\nfunction defineListeners(onEvent: (event: LastEvent) => void): () => void {\n  const w = window;\n  const [, cleanup] = createCbCollector(\n    // Add \"resize\" event listener to make sure, we always have fresh viewport information.\n    // The desktop version of Telegram is sometimes not sending the \"viewport_changed\"\n    // event. For example, when the Main Button is shown. That's why we should\n    // add our own listener to make sure viewport information is always fresh.\n    // Issue: https://github.com/Telegram-Mini-Apps/telegram-apps/issues/10\n    addEventListener(w, 'resize', () => {\n      onEvent(['viewport_changed', {\n        width: window.innerWidth,\n        height: window.innerHeight,\n        is_state_stable: true,\n        is_expanded: true,\n      }]);\n    }),\n    // Add listener, which handles events sent from the Telegram web application and also events\n    // generated by the local emitEvent function.\n    addEventListener(w, 'message', (event) => {\n      // Ignore non-parent window messages.\n      if (event.source !== w.parent) {\n        return;\n      }\n\n      // Parse incoming event data.\n      let message: MiniAppsMessage;\n      try {\n        message = miniAppsMessage()(event.data);\n      } catch {\n        // We ignore incorrect messages as they could be generated by any other code.\n        return;\n      }\n\n      const { eventType, eventData } = message;\n      const createTransformer = transformers[eventType as keyof typeof transformers];\n\n      try {\n        const transformed = createTransformer\n          ? createTransformer()(eventData)\n          : eventData;\n        logInfo('Event received:', transformed\n          ? { eventType, eventData: transformed }\n          : { eventType });\n        onEvent([eventType, transformed] as LastEvent);\n      } catch (cause) {\n        logError(\n          [\n            `An error occurred processing the \"${eventType}\" event from the Telegram application.`,\n            'Please, file an issue here:',\n            'https://github.com/Telegram-Mini-Apps/telegram-apps/issues/new/choose',\n          ].join('\\n'),\n          message,\n          cause,\n        );\n      }\n    }),\n  );\n\n  return cleanup;\n}\n\n/**\n * Last received event.\n */\nexport const $lastEvent = signal<LastEvent>();\n\n/**\n * Side effects listening cleanup function. It will be eventually set when some code tried\n * to retrieve the last event.\n */\nexport const $lastEventCleanup = signal<() => void>();\n\n/**\n * Retrieve last received Mini Apps event ensuring that external listeners were defined.\n */\nexport function lastEventSignal(): Signal<LastEvent | undefined> {\n  if (!$lastEventCleanup()) {\n    $lastEventCleanup.set(defineListeners($lastEvent.set));\n  }\n  return $lastEvent;\n}\n\n","import { type Signal, signal } from '@telegram-apps/signals';\n\nimport { lastEventSignal } from '@/events/listening/lastEvent.js';\nimport type { EventName } from '@/events/types/events.js';\nimport type { SignalPayload } from '@/events/listening/types.js';\n\ntype CachedSignal<E extends EventName> = Signal<SignalPayload<E>>;\ntype Cache = {\n  [E in EventName]?: CachedSignal<E>\n};\n\nexport const $eventSignalsCache = signal<Cache>({});\n\n/**\n * Returns a signal for specified event using cache.\n * @param event - event name.\n */\nexport function signalFor<E extends EventName>(event: E): CachedSignal<E> {\n  let cached = $eventSignalsCache()[event];\n  if (!cached) {\n    // This is the special symbol we use to notify signal, that nothing changed, and the current\n    // value should be preserved.\n    cached = signal(undefined, {\n      equals() {\n        // We may receive several undefined in a row. For example,\n        // in the main_button_pressed event.\n        return false;\n      },\n    }) as Cache[E];\n    lastEventSignal().sub(ev => {\n      if (ev && ev[0] === event) {\n        cached!.set(ev[1] as SignalPayload<E>);\n      }\n    });\n\n    $eventSignalsCache.set({ ...$eventSignalsCache(), [event]: cached });\n  }\n\n  return cached as CachedSignal<E>;\n}","import type { RemoveListenerFn } from '@telegram-apps/signals';\n\nimport { signalFor } from '@/events/listening/signalFor.js';\nimport type { EventName } from '@/events/types/events.js';\nimport type { EventListener } from '@/events/listening/types.js';\n\n/**\n * Adds a new listener to the specified event.\n * @param event - event name.\n * @param listener - event listener.\n * @param once - should listener be called only once.\n * @returns Function to remove bound event listener.\n */\nexport function on<E extends EventName>(\n  event: E,\n  listener: EventListener<E>,\n  once?: boolean,\n): RemoveListenerFn {\n  return signalFor(event).sub(listener, once);\n}","export const ERR_METHOD_UNSUPPORTED = 'ERR_METHOD_UNSUPPORTED';\nexport const ERR_RETRIEVE_LP_FAILED = 'ERR_RETRIEVE_LP_FAILED';\nexport const ERR_METHOD_PARAMETER_UNSUPPORTED = 'ERR_METHOD_PARAMETER_UNSUPPORTED';\nexport const ERR_UNKNOWN_ENV = 'ERR_UNKNOWN_ENV';\nexport const ERR_CUSTOM_METHOD_ERR_RESPONSE = 'ERR_INVOKE_CUSTOM_METHOD_RESPONSE';\n","import { signal } from '@telegram-apps/signals';\n\n/**\n * Target origin used by the `postEvent` method.\n *\n * You don't need to override this value until you know what you are doing.\n * @default 'https://web.telegram.org'\n */\nexport const $targetOrigin = signal('https://web.telegram.org');\n","import { fn, object } from '@telegram-apps/transformers';\nimport { TypedError } from '@telegram-apps/toolkit';\n\nimport { logInfo } from '@/debug.js';\nimport { isIframe } from '@/env/isIframe.js';\nimport { hasWebviewProxy } from '@/env/hasWebviewProxy.js';\nimport { ERR_UNKNOWN_ENV } from '@/errors.js';\nimport { $targetOrigin } from '@/methods/$targetOrigin.js';\nimport type {\n  MethodName,\n  MethodNameWithOptionalParams,\n  MethodNameWithoutParams,\n  MethodNameWithRequiredParams,\n  MethodParams,\n} from '@/methods/types/index.js';\n\nexport type PostEventFn = typeof postEvent;\n\n/**\n * Calls Mini Apps methods requiring parameters.\n * @param method - method name.\n * @param params - options along with params.\n * @throws {TypedError} ERR_UNKNOWN_ENV\n */\nexport function postEvent<Method extends MethodNameWithRequiredParams>(\n  method: Method,\n  params: MethodParams<Method>,\n): void;\n\n/**\n * Calls Mini Apps methods accepting no parameters at all.\n * @param method - method name.\n * @throws {TypedError} ERR_UNKNOWN_ENV\n */\nexport function postEvent(method: MethodNameWithoutParams): void;\n\n/**\n * Calls Mini Apps methods accepting optional parameters.\n * @param method - method name.\n * @param params - options along with params.\n * @throws {TypedError} ERR_UNKNOWN_ENV\n */\nexport function postEvent<Method extends MethodNameWithOptionalParams>(\n  method: Method,\n  params?: MethodParams<Method>,\n): void;\n\nexport function postEvent(\n  eventType: MethodName,\n  eventData?: MethodParams<MethodName>,\n): void {\n  logInfo('Posting event:', eventData ? { eventType, eventData } : { eventType });\n\n  const w = window;\n\n  // Telegram for iOS and macOS.\n  if (hasWebviewProxy(w)) {\n    w.TelegramWebviewProxy.postEvent(eventType, JSON.stringify(eventData));\n    return;\n  }\n\n  const message = JSON.stringify({ eventType, eventData });\n\n  // Telegram Web.\n  if (isIframe()) {\n    return w.parent.postMessage(message, $targetOrigin());\n  }\n\n  // Telegram for Windows Phone or Android.\n  const { external } = w;\n  if (object({ notify: fn() })().isValid(external)) {\n    external.notify(message);\n    return;\n  }\n\n  // Otherwise current environment is unknown, and we are not able to send event.\n  throw new TypedError(ERR_UNKNOWN_ENV);\n}\n","import {\n  CancelablePromise,\n  createCbCollector,\n  type If,\n  type IsNever,\n} from '@telegram-apps/toolkit';\n\nimport { on } from '@/events/listening/on.js';\nimport { postEvent } from '@/methods/postEvent.js';\nimport type {\n  MethodName,\n  MethodNameWithOptionalParams,\n  MethodNameWithoutParams,\n  MethodNameWithRequiredParams,\n  MethodParams,\n} from '@/methods/types/index.js';\nimport type { EventName, EventPayload } from '@/events/types/events.js';\nimport type { ExecuteWithOptions } from '@/types.js';\n\ntype AnyEventName = EventName | EventName[];\n\nexport type RequestCaptureFnEventsPayload<E extends EventName[]> = E extends (infer U extends EventName)[]\n  ? {\n    [K in U]: If<\n      IsNever<EventPayload<K>>,\n      { event: K },\n      { event: K; payload: EventPayload<K> }\n    >\n  }[U]\n  : never;\n\nexport type RequestCaptureEventsFn<E extends EventName[]> = (\n  payload: RequestCaptureFnEventsPayload<E>,\n) => boolean\n\nexport type RequestCaptureEventFn<E extends EventName> = If<\n  IsNever<EventPayload<E>>,\n  () => boolean,\n  (payload: EventPayload<E>) => boolean\n>;\n\nexport type RequestCaptureFn<E extends AnyEventName> = E extends EventName[]\n  ? RequestCaptureEventsFn<E>\n  : E extends EventName\n    ? RequestCaptureEventFn<E>\n    : never;\n\nexport interface RequestBasicOptions<E extends AnyEventName> extends ExecuteWithOptions {\n  /**\n   * Should return true if this event should be captured.\n   * The first compatible request will be captured if this property is omitted.\n   */\n  capture?: RequestCaptureFn<E>;\n}\n\nexport type RequestResult<E extends AnyEventName> =\n  E extends (infer U extends EventName)[]\n    ? U extends infer K extends EventName\n      ? If<IsNever<EventPayload<K>>, undefined, EventPayload<K>>\n      : never\n    : E extends EventName\n      ? If<IsNever<EventPayload<E>>, undefined, EventPayload<E>>\n      : never;\n\nexport type RequestFn = typeof request;\n\n/**\n * Performs a request waiting for specified events to occur.\n *\n * This overriding is used for methods, requiring parameters.\n * @param method - method name.\n * @param eventOrEvents - tracked event or events.\n * @param options - additional options.\n */\nexport function request<M extends MethodNameWithRequiredParams, E extends AnyEventName>(\n  method: M,\n  eventOrEvents: E,\n  options: RequestBasicOptions<E> & { params: MethodParams<M> },\n): CancelablePromise<RequestResult<E>>;\n\n/**\n * Performs a request waiting for specified events to occur.\n *\n * This overriding is used for methods with optional parameters.\n * @param method - method name.\n * @param eventOrEvents - tracked event or events.\n * @param options - additional options.\n */\nexport function request<M extends MethodNameWithOptionalParams, E extends AnyEventName>(\n  method: M,\n  eventOrEvents: E,\n  options?: RequestBasicOptions<E> & { params?: MethodParams<M> },\n): CancelablePromise<RequestResult<E>>;\n\n/**\n * Performs a request waiting for specified events to occur.\n *\n * This overriding is used for methods without parameters.\n * @param method - method name.\n * @param eventOrEvents - tracked event or events.\n * @param options - additional options.\n */\nexport function request<M extends MethodNameWithoutParams, E extends AnyEventName>(\n  method: M,\n  eventOrEvents: E,\n  options?: RequestBasicOptions<E>,\n): CancelablePromise<RequestResult<E>>;\n\nexport function request<M extends MethodName, E extends AnyEventName>(\n  method: M,\n  eventOrEvents: E,\n  options?: RequestBasicOptions<E> & { params?: MethodParams<M> },\n): CancelablePromise<RequestResult<E>> {\n  options ||= {};\n  const { capture } = options;\n  const [addCleanup, cleanup] = createCbCollector();\n\n  return new CancelablePromise<RequestResult<E>>((resolve) => {\n    // We need to iterate over all tracked events and create their event listeners.\n    ((Array.isArray(eventOrEvents) ? eventOrEvents : [eventOrEvents])).forEach(event => {\n      // Each event listener waits for the event to occur.\n      // Then, if the capture function was passed, we should check if the event should be captured.\n      // If the function is omitted, we instantly capture the event.\n      addCleanup(\n        on(event, payload => {\n          if (!capture || (\n            Array.isArray(eventOrEvents)\n              ? (capture as RequestCaptureEventsFn<EventName[]>)({\n                event,\n                payload,\n              } as RequestCaptureFnEventsPayload<EventName[]>)\n              : (capture as RequestCaptureEventFn<EventName>)(payload)\n          )) {\n            resolve(payload as RequestResult<E>);\n          }\n        }),\n      );\n    });\n\n    (options.postEvent || postEvent)(method as any, (options as any).params);\n  }, options)\n    .finally(cleanup);\n}\n","import { launchParams, type LaunchParams } from '@telegram-apps/transformers';\n\n/**\n * Parses value as launch parameters.\n * @param value - value to parse.\n */\nexport function parseLaunchParams(value: unknown): LaunchParams {\n  return launchParams()(value);\n}\n","import type { LaunchParams } from '@telegram-apps/types';\n\nimport { parseLaunchParams } from './parseLaunchParams.js';\n\n/**\n * @param urlString - URL to extract launch parameters from.\n * @returns Launch parameters from the specified URL.\n * @throws Error if function was unable to extract launch parameters from the passed URL.\n */\nexport function retrieveFromUrl(urlString: string): LaunchParams {\n  return parseLaunchParams(\n    urlString\n      // Replace everything before this first hashtag or question sign.\n      .replace(/^[^?#]*[?#]/, '')\n      // Replace all hashtags and question signs to make it look like some search params.\n      .replace(/[?#]/g, '&'),\n  );\n}\n","import type { LaunchParams } from '@telegram-apps/types';\n\nimport { retrieveFromUrl } from './retrieveFromUrl.js';\n\n/**\n * @returns Launch parameters from the current window location hash.\n * @throws Error if function was unable to extract launch parameters from the window location hash.\n */\nexport function retrieveFromLocation(): LaunchParams {\n  return retrieveFromUrl(window.location.href);\n}\n","import type { LaunchParams } from '@telegram-apps/types';\n\nimport { retrieveFromUrl } from './retrieveFromUrl.js';\n\n/**\n * @returns Launch parameters based on the first navigation entry.\n * @throws Error if function was unable to extract launch parameters from the navigation entry.\n */\nexport function retrieveFromPerformance(): LaunchParams {\n  const navigationEntry = performance.getEntriesByType('navigation')[0] as PerformanceNavigationTiming | undefined;\n  if (!navigationEntry) {\n    throw new Error('Unable to get first navigation entry.');\n  }\n\n  return retrieveFromUrl(navigationEntry.name);\n}\n","import { getStorageValue, setStorageValue } from '@telegram-apps/toolkit';\nimport { serializeLaunchParams } from '@telegram-apps/transformers';\nimport type { LaunchParams } from '@telegram-apps/types';\n\nimport { parseLaunchParams } from './parseLaunchParams.js';\n\nconst STORAGE_KEY = 'launchParams';\n\n/**\n * @returns Launch parameters stored in the session storage.\n * @throws Error if function was unable to extract launch parameters from the window location hash.\n */\nexport function retrieveFromStorage(): LaunchParams {\n  return parseLaunchParams(getStorageValue(STORAGE_KEY) || '');\n}\n\n/**\n * Saves specified launch parameters in the session storage.\n * @param value - launch params to save.\n */\nexport function saveToStorage(value: LaunchParams): void {\n  setStorageValue('launchParams', serializeLaunchParams(value));\n}\n","import type { LaunchParams } from '@telegram-apps/types';\nimport { TypedError } from '@telegram-apps/toolkit';\n\nimport { ERR_RETRIEVE_LP_FAILED } from '@/errors.js';\n\nimport { retrieveFromLocation } from './retrieveFromLocation.js';\nimport { retrieveFromPerformance } from './retrieveFromPerformance.js';\nimport { retrieveFromStorage, saveToStorage } from './storage.js';\n\nfunction unwrapError(e: unknown): string {\n  if (e instanceof Error) {\n    return e.message + (e.cause ? `\\n  ${unwrapError(e.cause)}` : '');\n  }\n  return JSON.stringify(e);\n}\n\n/**\n * @returns Launch parameters from any known source.\n * @throws {TypedError} ERR_RETRIEVE_LP_FAILED\n */\nexport function retrieveLaunchParams(): LaunchParams {\n  const errors: unknown[] = [];\n\n  for (const retrieve of [\n    // Try to retrieve launch parameters from the current location. This method can return\n    // nothing in case, location was changed, and then the page was reloaded.\n    retrieveFromLocation,\n    // Then, try using the lower level API - window.performance.\n    retrieveFromPerformance,\n    // Finally, try to extract launch parameters from the session storage.\n    retrieveFromStorage,\n  ]) {\n    try {\n      const lp = retrieve();\n      saveToStorage(lp);\n      return lp;\n    } catch (e) {\n      errors.push(e);\n    }\n  }\n\n  throw new TypedError(ERR_RETRIEVE_LP_FAILED, [\n    'Unable to retrieve launch parameters from any known source. Perhaps, you have opened your app outside Telegram?',\n    '📖 Refer to docs for more information:',\n    'https://docs.telegram-mini-apps.com/packages/telegram-apps-sdk/environment',\n    'Collected errors:',\n    ...errors.map(e => `— ${unwrapError(e)}`),\n  ].join('\\n'));\n}\n","import { CancelablePromise, type AsyncOptions } from '@telegram-apps/toolkit';\n\nimport { request } from '@/utils/request.js';\nimport { hasWebviewProxy } from '@/env/hasWebviewProxy.js';\nimport { retrieveLaunchParams } from '@/launch-params/retrieveLaunchParams.js';\n\n/**\n * Returns true if the current environment is Telegram Mini Apps.\n *\n * It uses the `retrieveLaunchParams` function to determine if the environment contains\n * launch parameters. In case it does, true will be returned.\n *\n * In case you need stricter checks, use async override of this function.\n */\nexport function isTMA(type: 'simple'): boolean;\n\n/**\n * Returns promise with true if the current environment is Telegram Mini Apps.\n *\n * First of all, it checks if the current environment contains traits specific to the\n * Mini Apps environment.\n * Then, it attempts to call a Mini Apps method and waits for a response to be received.\n *\n * In case you need less strict checks, use sync override of this function.\n */\nexport function isTMA(options?: AsyncOptions): CancelablePromise<boolean>\n\nexport function isTMA(optionsOrType?: AsyncOptions | 'simple'): boolean | CancelablePromise<boolean> {\n  if (optionsOrType === 'simple') {\n    try {\n      retrieveLaunchParams();\n      return true;\n    } catch {\n      return false;\n    }\n  }\n\n  return CancelablePromise.withFn(async () => {\n    if (hasWebviewProxy(window)) {\n      return true;\n    }\n    try {\n      await request('web_app_request_theme', 'theme_changed', { timeout: 100 });\n      return true;\n    } catch {\n      return false;\n    }\n  }, optionsOrType);\n}\n","/**\n * Emits an event sent from the Telegram native application like it was sent in a default web\n * environment between two iframes.\n *\n * It dispatches a new MessageEvent and expects it to be handled via\n * the `window.addEventListener('message', ...)` call, as a developer would do it to handle\n * messages sent from the parent iframe.\n * @param eventType - event name.\n * @param eventData - event payload.\n */\nexport function emitMiniAppsEvent(eventType: string, eventData?: unknown): void {\n  window.dispatchEvent(new MessageEvent('message', {\n    data: JSON.stringify({ eventType, eventData }),\n    // We specify window.parent to imitate the case, the parent iframe sent us this event.\n    source: window.parent,\n  }));\n}","import {\n  miniAppsMessage,\n  serializeThemeParams,\n  type ThemeParams,\n} from '@telegram-apps/transformers';\nimport type { LaunchParams } from '@telegram-apps/types';\n\nimport { parseLaunchParams } from '@/launch-params/parseLaunchParams.js';\nimport { saveToStorage } from '@/launch-params/storage.js';\nimport { logInfo } from '@/debug.js';\nimport { emitMiniAppsEvent } from '@/events/emitMiniAppsEvent.js';\nimport type { EventPayload } from '@/events/types/index.js';\n\n/**\n * Intercepts the window.parent.postMessage call and performs pre-defined actions. For example,\n * it may handle the request theme request and emit the theme_changed event.\n * @param tp - theme params.\n * @param data - postMessage data.\n */\nfunction imitatePostEvent(tp: ThemeParams, data: unknown): void {\n  if (typeof data !== 'string') {\n    return;\n  }\n  try {\n    const { eventType } = miniAppsMessage()(data);\n\n    if (eventType === 'web_app_request_theme') {\n      emitMiniAppsEvent('theme_changed', {\n        theme_params: JSON.parse(serializeThemeParams(tp)),\n      } satisfies EventPayload<'theme_changed'>);\n    }\n\n    if (eventType === 'web_app_request_viewport') {\n      emitMiniAppsEvent('viewport_changed', {\n        width: window.innerWidth,\n        height: window.innerHeight,\n        is_state_stable: true,\n        is_expanded: true,\n      } satisfies EventPayload<'viewport_changed'>);\n    }\n  } catch {\n  }\n}\n\n/**\n * Mocks a Telegram application environment.\n * @param launchParamsRaw - launch parameters presented as a string or query parameters.\n */\nexport function mockTelegramEnv(launchParamsRaw: LaunchParams | string): void {\n  const lp = typeof launchParamsRaw === 'string'\n    ? parseLaunchParams(launchParamsRaw)\n    : launchParamsRaw;\n\n  // Save launch params in the storage, so retrieveLaunchParams will return them.\n  saveToStorage(lp);\n\n  // Define a special port, expected by the postEvent function.\n  const proxyPostEvent = (window as any).TelegramWebviewProxy?.postEvent;\n  (window as any).TelegramWebviewProxy = {\n    postEvent(eventType: string, eventData: string) {\n      imitatePostEvent(lp.themeParams, JSON.stringify({ eventType, eventData }));\n      proxyPostEvent?.(eventType, eventData);\n    },\n  };\n\n  logInfo('Environment was mocked by the mockTelegramEnv function');\n}","import { emitMiniAppsEvent } from '@/events/emitMiniAppsEvent.js';\n\n/**\n * Defines special handlers by known paths, which Telegram recognizes as ports to receive events.\n */\nexport function defineEventHandlers() {\n  // Iterate over each path, where \"receiveEvent\" function should be\n  // defined. This function is called by external environment in case,\n  // it wants to emit some event.\n  [\n    ['TelegramGameProxy_receiveEvent'], // Windows Phone.\n    ['TelegramGameProxy', 'receiveEvent'], // Desktop.\n    ['Telegram', 'WebView', 'receiveEvent'], // Android and iOS.\n  ].forEach((path) => {\n    // Path starts from the \"window\" object.\n    let pointer = window as Record<string, any>;\n\n    path.forEach((item, idx, arr) => {\n      // We are on the last iteration, where function property name is passed.\n      if (idx === arr.length - 1) {\n        pointer[item] = emitMiniAppsEvent;\n        return;\n      }\n\n      if (!(item in pointer)) {\n        pointer[item] = {};\n      }\n      pointer = pointer[item];\n    });\n  });\n}\n","/**\n * Removes global event handlers, used by the package.\n */\nexport function removeEventHandlers(): void {\n  ['TelegramGameProxy_receiveEvent', 'TelegramGameProxy', 'Telegram'].forEach((prop) => {\n    delete window[prop as keyof Window];\n  });\n}","import { signalFor } from '@/events/listening/signalFor.js';\nimport type { EventName } from '@/events/types/events.js';\nimport type { EventListener } from '@/events/listening/types.js';\n\n/**\n * Removes the listener from the specified event.\n * @param event - event to listen.\n * @param listener - event listener to remove.\n * @param once - had this listener to be called only once.\n */\nexport function off<E extends EventName>(\n  event: E,\n  listener: EventListener<E>,\n  once?: boolean,\n): void {\n  signalFor(event).unsub(listener, once);\n}\n","import type { RemoveListenerFn } from '@telegram-apps/signals';\n\nimport { lastEventSignal } from '@/events/listening/lastEvent.js';\nimport type { SubscribeListener } from '@/events/listening/types.js';\n\n/**\n * Subscribes to all events sent from the native Telegram application.\n * @param listener - event listener to bind.\n * @param once - should this listener be called only once.\n * @returns Function to remove bound event listener.\n */\nexport function subscribe(listener: SubscribeListener, once?: boolean): RemoveListenerFn {\n  return lastEventSignal().sub(listener, once);\n}\n","import type { SubscribeListenerFn } from '@telegram-apps/signals';\n\nimport { $lastEvent, LastEvent } from '@/events/listening/lastEvent.js';\n\n/**\n * Remove a subscriber listening to all events sent from the native Telegram application.\n * @param listener - event listener to remove.\n * @param once - had this listener to be called only once.\n * @returns Function to remove bound event listener.\n */\nexport function unsubscribe(\n  listener: SubscribeListenerFn<LastEvent | undefined>,\n  once?: boolean,\n): void {\n  $lastEvent.unsub(listener, once);\n}\n","type CaptureSameReqFn = (payload: { req_id: string }) => boolean;\n\n/**\n * Returns a function which can be used in `request` function `capture` property to capture\n * the event with the same request identifier.\n * @param reqId - request identifier.\n */\nexport function captureSameReq(reqId: string): CaptureSameReqFn {\n  return ({ req_id }) => req_id === reqId;\n}\n","import type { Version } from '@telegram-apps/types';\n\nfunction parts(a: Version): number[] {\n  return a.split('.').map(Number);\n}\n\n/**\n * @param a - first version.\n * @param b - second version.\n * @returns\n * - `1` if the version \"a\" is greater than \"b\".\n * - `0` the version \"a\" is equal to \"b\".\n * - `-1` the version \"a\" is lower than \"b\".\n */\nexport function compareVersions(a: Version, b: Version): number {\n  const aParts = parts(a);\n  const bParts = parts(b);\n  const len = Math.max(aParts.length, bParts.length);\n\n  // Iterate over each part of versions and compare them. In case, part is\n  // missing, assume its value is equal to 0.\n  for (let i = 0; i < len; i += 1) {\n    const aVal = aParts[i] || 0\n    const bVal = bParts[i] || 0;\n\n    if (aVal === bVal) {\n      continue;\n    }\n    return aVal > bVal ? 1 : -1;\n  }\n  return 0;\n}\n","import type { Version } from '@telegram-apps/types';\n\nimport { compareVersions } from '@/utils/compareVersions.js';\nimport type {\n  MethodName,\n  MethodNameWithVersionedParams,\n  MethodVersionedParams,\n} from '@/methods/types/index.js';\n\n/**\n * Returns true if \"a\" version is less than or equal to \"b\" version.\n * @param a\n * @param b\n */\nfunction versionLessOrEqual(a: Version, b: Version): boolean {\n  return compareVersions(a, b) <= 0;\n}\n\n/**\n * Returns true in case, passed parameter in specified method is supported.\n * @param method - method name\n * @param param - method parameter\n * @param inVersion - platform version.\n */\nexport function supports<M extends MethodNameWithVersionedParams>(\n  method: M,\n  param: MethodVersionedParams<M>,\n  inVersion: Version,\n): boolean;\n\n/**\n * Returns true in case, specified method is supported in a passed version.\n * @param method - method name.\n * @param inVersion - platform version.\n */\nexport function supports(method: MethodName, inVersion: Version): boolean;\n\nexport function supports(\n  method: MethodName,\n  paramOrVersion: Version | string,\n  inVersion?: string,\n): boolean {\n  // Method name, parameter, target version.\n  if (typeof inVersion === 'string') {\n    if (method === 'web_app_open_link') {\n      if (paramOrVersion === 'try_instant_view') {\n        return versionLessOrEqual('6.4', inVersion);\n      }\n      if (paramOrVersion === 'try_browser') {\n        return versionLessOrEqual('7.6', inVersion);\n      }\n    }\n\n    if (method === 'web_app_set_header_color') {\n      if (paramOrVersion === 'color') {\n        return versionLessOrEqual('6.9', inVersion);\n      }\n    }\n\n    if (method === 'web_app_close' && paramOrVersion === 'return_back') {\n      return versionLessOrEqual('7.6', inVersion);\n    }\n\n    if (method === 'web_app_setup_main_button' && paramOrVersion === 'has_shine_effect') {\n      return versionLessOrEqual('7.10', inVersion);\n    }\n  }\n\n  switch (method) {\n    case 'web_app_open_tg_link':\n    case 'web_app_open_invoice':\n    case 'web_app_setup_back_button':\n    case 'web_app_set_background_color':\n    case 'web_app_set_header_color':\n    case 'web_app_trigger_haptic_feedback':\n      return versionLessOrEqual('6.1', paramOrVersion);\n    case 'web_app_open_popup':\n      return versionLessOrEqual('6.2', paramOrVersion);\n    case 'web_app_close_scan_qr_popup':\n    case 'web_app_open_scan_qr_popup':\n    case 'web_app_read_text_from_clipboard':\n      return versionLessOrEqual('6.4', paramOrVersion);\n    case 'web_app_switch_inline_query':\n      return versionLessOrEqual('6.7', paramOrVersion);\n    case 'web_app_invoke_custom_method':\n    case 'web_app_request_write_access':\n    case 'web_app_request_phone':\n      return versionLessOrEqual('6.9', paramOrVersion);\n    case 'web_app_setup_settings_button':\n      return versionLessOrEqual('6.10', paramOrVersion);\n    case 'web_app_biometry_get_info':\n    case 'web_app_biometry_open_settings':\n    case 'web_app_biometry_request_access':\n    case 'web_app_biometry_request_auth':\n    case 'web_app_biometry_update_token':\n      return versionLessOrEqual('7.2', paramOrVersion);\n    case 'web_app_setup_swipe_behavior':\n      return versionLessOrEqual('7.7', paramOrVersion);\n    case 'web_app_setup_secondary_button':\n    case 'web_app_set_bottom_bar_color':\n      return versionLessOrEqual('7.10', paramOrVersion);\n    default:\n      return [\n        'iframe_ready',\n        'iframe_will_reload',\n        'web_app_close',\n        'web_app_data_send',\n        'web_app_expand',\n        'web_app_open_link',\n        'web_app_ready',\n        'web_app_request_theme',\n        'web_app_request_viewport',\n        'web_app_setup_main_button',\n        'web_app_setup_closing_behavior',\n      ].includes(method);\n  }\n}\n","import { isRecord } from '@telegram-apps/transformers';\nimport { TypedError } from '@telegram-apps/toolkit';\nimport type { Version } from '@telegram-apps/types';\n\nimport { ERR_METHOD_PARAMETER_UNSUPPORTED, ERR_METHOD_UNSUPPORTED } from '@/errors.js';\nimport { supports } from '@/methods/supports.js';\nimport { type PostEventFn, postEvent } from '@/methods/postEvent.js';\nimport type {\n  MethodName,\n  MethodNameWithVersionedParams,\n  MethodVersionedParams,\n} from '@/methods/types/index.js';\n\nexport type OnUnsupportedFn = (\n  data: { version: Version } & (\n    | { method: MethodName }\n    | {\n    [M in MethodNameWithVersionedParams]: {\n      method: M;\n      param: MethodVersionedParams<M>;\n    };\n  }[MethodNameWithVersionedParams]),\n) => void;\n\nexport type CreatePostEventMode = 'strict' | 'non-strict';\n\n/**\n * Creates a function which checks if specified method and parameters are supported.\n *\n * If method or parameters are unsupported, the `onUnsupported` function will be called.\n *\n * If `strict` or `non-strict` value was passed as the second argument, the function\n * will create its own `onUnsupported` function with behavior depending on the value passed.\n *\n * - Passing `strict` will make function to throw a `TypedError` error\n * with `ERR_METHOD_UNSUPPORTED` or `ERR_METHOD_PARAMETER_UNSUPPORTED` type.\n * - Passing `non-strict` will just warn you about something being unsupported.\n *\n * @param version - Telegram Mini Apps version.\n * @param onUnsupportedOrMode - function or strict mode. Default: `strict`\n */\nexport function createPostEvent(\n  version: Version,\n  onUnsupportedOrMode?: OnUnsupportedFn | CreatePostEventMode,\n): PostEventFn {\n  onUnsupportedOrMode ||= 'strict';\n  const onUnsupported: OnUnsupportedFn = typeof onUnsupportedOrMode === 'function'\n    ? onUnsupportedOrMode\n    : data => {\n      const { method, version } = data;\n      let message: string;\n      let error: string;\n\n      if ('param' in data) {\n        message = `Parameter \"${data.param}\" of \"${method}\" method is unsupported in Mini Apps version ${version}`;\n        error = ERR_METHOD_PARAMETER_UNSUPPORTED;\n      } else {\n        message = `Method \"${method}\" is unsupported in Mini Apps version ${version}`;\n        error = ERR_METHOD_UNSUPPORTED;\n      }\n\n      if (onUnsupportedOrMode === 'strict') {\n        throw new TypedError(error, message);\n      }\n      return console.warn(message);\n    };\n\n  return ((method: any, params: any) => {\n    // Firstly, check if a method is supported.\n    if (!supports(method, version)) {\n      return onUnsupported({ version, method });\n    }\n\n    // Method could use parameters, which are supported only in specific versions of Mini Apps.\n    // We are validating only those parameters, which are not backward compatible.\n    if (\n      isRecord(params)\n      && method === 'web_app_set_header_color'\n      && 'color' in params\n      && !supports(method, 'color', version)\n    ) {\n      return onUnsupported({ version, method, param: 'color' });\n    }\n\n    return postEvent(method, params);\n  }) as PostEventFn;\n}\n","import { CancelablePromise, TypedError } from '@telegram-apps/toolkit';\n\nimport { ERR_CUSTOM_METHOD_ERR_RESPONSE } from '@/errors.js';\nimport { captureSameReq } from '@/methods/captureSameReq.js';\nimport type { ExecuteWithOptions } from '@/types.js';\nimport type { CustomMethodName, CustomMethodParams } from '@/methods/types/index.js';\n\nimport { request } from './request.js';\n\n/**\n * Invokes known custom method. Returns method execution result.\n * @param method - method name.\n * @param params - method parameters.\n * @param requestId - request identifier.\n * @param options - additional options.\n * @throws {TypedError} ERR_CUSTOM_METHOD_ERR_RESPONSE\n */\nexport function invokeCustomMethod<M extends CustomMethodName>(\n  method: M,\n  params: CustomMethodParams<M>,\n  requestId: string,\n  options?: ExecuteWithOptions,\n): CancelablePromise<unknown>;\n\n/**\n * Invokes unknown custom method. Returns method execution result.\n * @param method - method name.\n * @param params - method parameters.\n * @param requestId - request identifier.\n * @param options - additional options.\n * @throws {TypedError} ERR_CUSTOM_METHOD_ERR_RESPONSE\n */\nexport function invokeCustomMethod(\n  method: string,\n  params: object,\n  requestId: string,\n  options?: ExecuteWithOptions,\n): CancelablePromise<unknown>;\n\nexport function invokeCustomMethod(\n  method: string,\n  params: object,\n  requestId: string,\n  options?: ExecuteWithOptions,\n): CancelablePromise<unknown> {\n  return request('web_app_invoke_custom_method', 'custom_method_invoked', {\n    ...options || {},\n    params: { method, params, req_id: requestId },\n    capture: captureSameReq(requestId),\n  })\n    .then(({ result, error }) => {\n      if (error) {\n        throw new TypedError(ERR_CUSTOM_METHOD_ERR_RESPONSE, error);\n      }\n      return result;\n    });\n}\n","import type { Signal } from '@telegram-apps/signals';\n\nimport { $eventSignalsCache } from '@/events/listening/signalFor.js';\nimport { $lastEvent, $lastEventCleanup } from '@/events/listening/lastEvent.js';\nimport { $targetOrigin } from '@/methods/$targetOrigin.js';\nimport { $debug } from '@/debug.js';\n\nfunction resetSignal(s: Signal<any>): void {\n  s.unsubAll();\n  s.reset();\n}\n\n/**\n * Resets the package state. Normally, you don't use this function in your application.\n * We are using it only for test purposes.\n */\nexport function resetPackageState() {\n  $lastEventCleanup()?.();\n\n  [\n    ...Object.values($eventSignalsCache()),\n    $eventSignalsCache,\n    $lastEvent,\n    $lastEventCleanup,\n    $targetOrigin,\n    $debug,\n  ].forEach(resetSignal);\n}"],"names":["i","e","r","a","b","t","E","R","S","w","h","y","n","o","c","p","d","s","l","f","u","g","D","P","m","U","N","O","W","_","T","V","$","j","L","C","B","webViewProxy","object","fn","hasWebviewProxy","value","isIframe","k","I","x","F","A","v","Z","J","K","M","z","G","q","H","$debug","signal","logInfo","logError","createLogger","transformers","string","createTransformerGen","number","boolean","defineListeners","onEvent","cleanup","createCbCollector","addEventListener","event","message","miniAppsMessage","eventType","eventData","createTransformer","transformed","cause","$lastEvent","$lastEventCleanup","lastEventSignal","$eventSignalsCache","signalFor","cached","ev","on","listener","once","ERR_METHOD_UNSUPPORTED","ERR_RETRIEVE_LP_FAILED","ERR_METHOD_PARAMETER_UNSUPPORTED","ERR_UNKNOWN_ENV","ERR_CUSTOM_METHOD_ERR_RESPONSE","$targetOrigin","postEvent","external","TypedError","request","method","eventOrEvents","options","capture","addCleanup","CancelablePromise","resolve","payload","parseLaunchParams","launchParams","retrieveFromUrl","urlString","retrieveFromLocation","retrieveFromPerformance","navigationEntry","STORAGE_KEY","retrieveFromStorage","getStorageValue","saveToStorage","setStorageValue","serializeLaunchParams","unwrapError","retrieveLaunchParams","errors","retrieve","lp","isTMA","optionsOrType","emitMiniAppsEvent","imitatePostEvent","tp","data","serializeThemeParams","mockTelegramEnv","launchParamsRaw","proxyPostEvent","_a","defineEventHandlers","path","pointer","item","idx","arr","removeEventHandlers","prop","off","subscribe","unsubscribe","captureSameReq","reqId","req_id","parts","compareVersions","aParts","bParts","len","aVal","bVal","versionLessOrEqual","supports","paramOrVersion","inVersion","createPostEvent","version","onUnsupportedOrMode","onUnsupported","error","params","isRecord","invokeCustomMethod","requestId","result","resetSignal","resetPackageState"],"mappings":"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"}